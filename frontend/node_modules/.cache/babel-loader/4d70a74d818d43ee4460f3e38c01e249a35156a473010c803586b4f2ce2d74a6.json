{"ast":null,"code":"const axios = require('axios');\nconst cheerio = require('cheerio');\nconst NEWS_URL_URI = 'https://myanimelist.net/news?p=';\n\n/* istanbul ignore next */\nconst byProperty = prop => {\n  return (a, b) => {\n    return typeof a[prop] === 'number' ? a[prop] - b[prop] : a[prop] < b[prop] ? -1 : a[prop] > b[prop] ? 1 : 0;\n  };\n};\n\n// 160 news. This is already expensive enough\nmodule.exports = (nbNews = 160) => {\n  return new Promise((resolve, reject) => {\n    const maxPage = Math.ceil(nbNews / 20) + 1;\n    const promises = [];\n    for (let i = 1; i < maxPage; ++i) {\n      promises.push(axios.get(`${NEWS_URL_URI}${i}`));\n    }\n    axios.all(promises).then(axios.spread(function () {\n      const result = [];\n      for (let i = 0; i < maxPage - 1; ++i) {\n        const {\n          data\n        } = arguments[`${i}`];\n        const $ = cheerio.load(data);\n        const pageElements = $('.news-unit-right'); // 20 elements\n\n        // Pictures for each element\n        const images = [];\n        $('.image').each(function () {\n          images.push($(this).attr('src'));\n        });\n\n        // Get links for info\n        const links = [];\n        $('.image-link').each(function () {\n          links.push($(this).attr('href'));\n        });\n\n        // Gathering news' Titles\n        const titles = pageElements.find('p.title').text().split('\\n      ');\n        titles.shift();\n        const texts = pageElements.find('div.text').text().split('\\n      ');\n        texts.shift();\n        for (let i = 0, l = titles.length; i < l; ++i) {\n          titles[i] = titles[i].slice(0, -5);\n          texts[i] = texts[i].slice(0, -5);\n        }\n        for (let i = 0, l = titles.length; i < l; ++i) {\n          const tmp = links[i].split('/');\n          result.push({\n            title: titles[i],\n            link: links[i],\n            image: images[i],\n            text: texts[i],\n            newsNumber: tmp[tmp.length - 1]\n          });\n        }\n      }\n      result.sort(byProperty('newsNumber'));\n      result.reverse();\n      resolve(result.slice(0, nbNews));\n    })).catch( /* istanbul ignore next */err => reject(err));\n  });\n};","map":{"version":3,"names":["axios","require","cheerio","NEWS_URL_URI","byProperty","prop","a","b","module","exports","nbNews","Promise","resolve","reject","maxPage","Math","ceil","promises","i","push","get","all","then","spread","result","data","arguments","$","load","pageElements","images","each","attr","links","titles","find","text","split","shift","texts","l","length","slice","tmp","title","link","image","newsNumber","sort","reverse","catch","err"],"sources":["C:/Users/elric/Desktop/reactsql/frontend/node_modules/mal-scraper/src/news.js"],"sourcesContent":["const axios = require('axios')\nconst cheerio = require('cheerio')\n\nconst NEWS_URL_URI = 'https://myanimelist.net/news?p='\n\n/* istanbul ignore next */\nconst byProperty = (prop) => {\n  return (a, b) => {\n    return typeof a[prop] === 'number'\n      ? (a[prop] - b[prop])\n      : (a[prop] < b[prop])\n        ? -1\n        : (a[prop] > b[prop])\n          ? 1\n          : 0\n  }\n}\n\n// 160 news. This is already expensive enough\nmodule.exports = (nbNews = 160) => {\n  return new Promise((resolve, reject) => {\n    const maxPage = Math.ceil(nbNews / 20) + 1\n\n    const promises = []\n\n    for (let i = 1; i < maxPage; ++i) {\n      promises.push(axios.get(`${NEWS_URL_URI}${i}`))\n    }\n\n    axios.all(promises)\n      .then(axios.spread(function () {\n        const result = []\n\n        for (let i = 0; i < maxPage - 1; ++i) {\n          const { data } = arguments[`${i}`]\n          const $ = cheerio.load(data)\n\n          const pageElements = $('.news-unit-right') // 20 elements\n\n          // Pictures for each element\n          const images = []\n          $('.image').each(function () {\n            images.push($(this).attr('src'))\n          })\n\n          // Get links for info\n          const links = []\n          $('.image-link').each(function () {\n            links.push($(this).attr('href'))\n          })\n\n          // Gathering news' Titles\n          const titles = pageElements.find('p.title').text().split('\\n      ')\n          titles.shift()\n          const texts = pageElements.find('div.text').text().split('\\n      ')\n          texts.shift()\n\n          for (let i = 0, l = titles.length; i < l; ++i) {\n            titles[i] = titles[i].slice(0, -5)\n            texts[i] = texts[i].slice(0, -5)\n          }\n\n          for (let i = 0, l = titles.length; i < l; ++i) {\n            const tmp = links[i].split('/')\n            result.push({\n              title: titles[i],\n              link: links[i],\n              image: images[i],\n              text: texts[i],\n              newsNumber: tmp[tmp.length - 1]\n            })\n          }\n        }\n\n        result.sort(byProperty('newsNumber'))\n        result.reverse()\n        resolve(result.slice(0, nbNews))\n      }))\n      .catch(/* istanbul ignore next */(err) => reject(err))\n  })\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
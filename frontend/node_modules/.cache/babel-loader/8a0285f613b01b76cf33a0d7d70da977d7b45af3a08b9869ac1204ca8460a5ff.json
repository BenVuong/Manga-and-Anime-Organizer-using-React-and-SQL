{"ast":null,"code":"const axios = require('axios');\nconst cheerio = require('cheerio');\nconst {\n  getResultsFromSearch\n} = require('./info.js');\nconst BASE_URI = 'https://myanimelist.net/anime/';\nconst malNumberToJsNumber = malNumber => {\n  if (malNumber) {\n    malNumber = malNumber.replace(/\\D/gi, '');\n    return Number(malNumber);\n  }\n  return 0;\n};\nconst parsePage = $ => {\n  const stats = $('#content table td:nth-child(2) .spaceit_pad');\n  const summaryStats = stats.slice(0, 6);\n  const scoreStats = stats.slice(6);\n  const scoreStatsLength = scoreStats.length;\n  const result = {};\n  summaryStats.each(function (elem) {\n    $(this).find('span').remove();\n  });\n  result.watching = malNumberToJsNumber($(summaryStats[0]).text());\n  result.completed = malNumberToJsNumber($(summaryStats[1]).text());\n  result.onHold = malNumberToJsNumber($(summaryStats[2]).text());\n  result.dropped = malNumberToJsNumber($(summaryStats[3]).text());\n  result.planToWatch = malNumberToJsNumber($(summaryStats[4]).text());\n  result.total = malNumberToJsNumber($(summaryStats[5]).text());\n  scoreStats.each(function (index) {\n    result['score' + (scoreStatsLength - index)] = malNumberToJsNumber($(this).find('small').text());\n  });\n  return result;\n};\nconst searchPage = url => {\n  return new Promise((resolve, reject) => {\n    axios.get(url).then(({\n      data\n    }) => {\n      const $ = cheerio.load(data);\n      const res = parsePage($);\n      resolve(res);\n    }).catch( /* istanbul ignore next */err => reject(err));\n  });\n};\nconst getStatsFromName = name => {\n  return new Promise((resolve, reject) => {\n    getResultsFromSearch(name).then(items => {\n      const {\n        url\n      } = items[0];\n      searchPage(`${encodeURI(url)}/stats`).then(data => resolve(data)).catch( /* istanbul ignore next */err => reject(err));\n    }).catch( /* istanbul ignore next */err => reject(err));\n  });\n};\nconst getStatsFromNameAndId = (id, name) => {\n  return new Promise((resolve, reject) => {\n    searchPage(`${BASE_URI}${id}/${encodeURI(name)}/stats`).then(data => resolve(data)).catch( /* istanbul ignore next */err => reject(err));\n  });\n};\nconst getStats = obj => {\n  return new Promise((resolve, reject) => {\n    if (!obj) {\n      reject(new Error('[Mal-Scraper]: No id nor name received.'));\n      return;\n    }\n    if (typeof obj === 'object' && !obj[0]) {\n      const {\n        id,\n        name\n      } = obj;\n      if (!id || !name || isNaN(+id) || typeof name !== 'string') {\n        reject(new Error('[Mal-Scraper]: Malformed input. ID or name is malformed or missing.'));\n        return;\n      }\n      getStatsFromNameAndId(id, name).then(data => resolve(data)).catch( /* istanbul ignore next */err => reject(err));\n    } else {\n      getStatsFromName(obj).then(data => resolve(data)).catch( /* istanbul ignore next */err => reject(err));\n    }\n  });\n};\nmodule.exports = {\n  getStats\n};","map":{"version":3,"names":["axios","require","cheerio","getResultsFromSearch","BASE_URI","malNumberToJsNumber","malNumber","replace","Number","parsePage","$","stats","summaryStats","slice","scoreStats","scoreStatsLength","length","result","each","elem","find","remove","watching","text","completed","onHold","dropped","planToWatch","total","index","searchPage","url","Promise","resolve","reject","get","then","data","load","res","catch","err","getStatsFromName","name","items","encodeURI","getStatsFromNameAndId","id","getStats","obj","Error","isNaN","module","exports"],"sources":["C:/Users/elric/Desktop/reactsql/frontend/node_modules/mal-scraper/src/stats.js"],"sourcesContent":["const axios = require('axios')\nconst cheerio = require('cheerio')\nconst { getResultsFromSearch } = require('./info.js')\n\nconst BASE_URI = 'https://myanimelist.net/anime/'\n\nconst malNumberToJsNumber = (malNumber) => {\n  if (malNumber) {\n    malNumber = malNumber.replace(/\\D/gi, '')\n    return Number(malNumber)\n  }\n\n  return 0\n}\n\nconst parsePage = ($) => {\n  const stats = $('#content table td:nth-child(2) .spaceit_pad')\n\n  const summaryStats = stats.slice(0, 6)\n  const scoreStats = stats.slice(6)\n  const scoreStatsLength = scoreStats.length\n  const result = {}\n\n  summaryStats.each(function (elem) {\n    $(this).find('span').remove()\n  })\n\n  result.watching = malNumberToJsNumber($(summaryStats[0]).text())\n  result.completed = malNumberToJsNumber($(summaryStats[1]).text())\n  result.onHold = malNumberToJsNumber($(summaryStats[2]).text())\n  result.dropped = malNumberToJsNumber($(summaryStats[3]).text())\n  result.planToWatch = malNumberToJsNumber($(summaryStats[4]).text())\n  result.total = malNumberToJsNumber($(summaryStats[5]).text())\n\n  scoreStats.each(function (index) {\n    result['score' + (scoreStatsLength - index)] = malNumberToJsNumber($(this).find('small').text())\n  })\n\n  return result\n}\n\nconst searchPage = (url) => {\n  return new Promise((resolve, reject) => {\n    axios.get(url)\n      .then(({ data }) => {\n        const $ = cheerio.load(data)\n        const res = parsePage($)\n        resolve(res)\n      })\n      .catch(/* istanbul ignore next */(err) => reject(err))\n  })\n}\n\nconst getStatsFromName = (name) => {\n  return new Promise((resolve, reject) => {\n    getResultsFromSearch(name)\n      .then((items) => {\n        const { url } = items[0]\n\n        searchPage(`${encodeURI(url)}/stats`)\n          .then((data) => resolve(data))\n          .catch(/* istanbul ignore next */(err) => reject(err))\n      })\n      .catch(/* istanbul ignore next */(err) => reject(err))\n  })\n}\n\nconst getStatsFromNameAndId = (id, name) => {\n  return new Promise((resolve, reject) => {\n    searchPage(`${BASE_URI}${id}/${encodeURI(name)}/stats`)\n      .then((data) => resolve(data))\n      .catch(/* istanbul ignore next */(err) => reject(err))\n  })\n}\n\nconst getStats = (obj) => {\n  return new Promise((resolve, reject) => {\n    if (!obj) {\n      reject(new Error('[Mal-Scraper]: No id nor name received.'))\n      return\n    }\n\n    if (typeof obj === 'object' && !obj[0]) {\n      const { id, name } = obj\n\n      if (!id || !name || isNaN(+id) || typeof name !== 'string') {\n        reject(new Error('[Mal-Scraper]: Malformed input. ID or name is malformed or missing.'))\n        return\n      }\n\n      getStatsFromNameAndId(id, name)\n        .then((data) => resolve(data))\n        .catch(/* istanbul ignore next */(err) => reject(err))\n    } else {\n      getStatsFromName(obj)\n        .then((data) => resolve(data))\n        .catch(/* istanbul ignore next */(err) => reject(err))\n    }\n  })\n}\n\nmodule.exports = {\n  getStats\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}
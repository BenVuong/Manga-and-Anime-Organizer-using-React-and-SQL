{"ast":null,"code":"const axios = require('axios');\nconst cheerio = require('cheerio');\nconst {\n  getResultsFromSearch\n} = require('./info.js');\nconst BASE_URI = 'https://myanimelist.net/anime/';\nconst parsePage = $ => {\n  const recommendations = $('#content td:nth-child(2) .borderClass table');\n  const results = [];\n  recommendations.each(function () {\n    const recommendation = {};\n    recommendation.pictureImage = $(this).find('tr td:nth-child(1) .picSurround img').attr('data-src');\n    recommendation.animeLink = $(this).find('tr td:nth-child(1) .picSurround a').attr('href');\n    recommendation.anime = $(this).find('tr td:nth-child(2) div:nth-child(2) a strong').text().trim();\n    recommendation.mainRecommendation = $(this).find('tr td:nth-child(2) .detail-user-recs-text').text().trim();\n    recommendation.author = $(this).find('tr td:nth-child(2) > .borderClass .spaceit_pad:nth-child(2) > a').text().trim();\n    results.push(recommendation);\n  });\n  return results;\n};\nconst searchPage = url => {\n  return new Promise((resolve, reject) => {\n    axios.get(url).then(({\n      data\n    }) => {\n      const $ = cheerio.load(data);\n      const res = parsePage($);\n      resolve(res);\n    }).catch( /* istanbul ignore next */err => reject(err));\n  });\n};\nconst getRecommendationsFromName = name => {\n  return new Promise((resolve, reject) => {\n    getResultsFromSearch(name).then(items => {\n      const {\n        url\n      } = items[0];\n      searchPage(`${encodeURI(url)}/userrecs`).then(data => resolve(data)).catch( /* istanbul ignore next */err => reject(err));\n    }).catch( /* istanbul ignore next */err => reject(err));\n  });\n};\nconst getRecommendationsFromNameAndId = (id, name = 'anything') => {\n  return new Promise((resolve, reject) => {\n    searchPage(`${BASE_URI}${id}/${encodeURI(name)}/userrecs`).then(data => resolve(data)).catch( /* istanbul ignore next */err => reject(err));\n  });\n};\nconst getRecommendationsList = obj => {\n  return new Promise((resolve, reject) => {\n    if (!obj) {\n      reject(new Error('[Mal-Scraper]: No id nor name received.'));\n      return;\n    }\n    if (typeof obj === 'object' && !obj[0]) {\n      const {\n        id,\n        name\n      } = obj;\n      if (!id || isNaN(+id) || name && typeof name !== 'string') {\n        reject(new Error('[Mal-Scraper]: Malformed input. ID or name is malformed or missing.'));\n        return;\n      }\n      getRecommendationsFromNameAndId(id, name).then(data => resolve(data)).catch( /* istanbul ignore next */err => reject(err));\n    } else {\n      getRecommendationsFromName(obj).then(data => resolve(data)).catch( /* istanbul ignore next */err => reject(err));\n    }\n  });\n};\nmodule.exports = {\n  getRecommendationsList\n};","map":{"version":3,"names":["axios","require","cheerio","getResultsFromSearch","BASE_URI","parsePage","$","recommendations","results","each","recommendation","pictureImage","find","attr","animeLink","anime","text","trim","mainRecommendation","author","push","searchPage","url","Promise","resolve","reject","get","then","data","load","res","catch","err","getRecommendationsFromName","name","items","encodeURI","getRecommendationsFromNameAndId","id","getRecommendationsList","obj","Error","isNaN","module","exports"],"sources":["C:/Users/elric/Desktop/reactsql/frontend/node_modules/mal-scraper/src/recommendations.js"],"sourcesContent":["const axios = require('axios')\nconst cheerio = require('cheerio')\nconst { getResultsFromSearch } = require('./info.js')\n\nconst BASE_URI = 'https://myanimelist.net/anime/'\n\nconst parsePage = ($) => {\n  const recommendations = $('#content td:nth-child(2) .borderClass table')\n  const results = []\n  recommendations.each(function () {\n    const recommendation = {}\n    recommendation.pictureImage = $(this).find('tr td:nth-child(1) .picSurround img').attr('data-src')\n    recommendation.animeLink = $(this).find('tr td:nth-child(1) .picSurround a').attr('href')\n    recommendation.anime = $(this).find('tr td:nth-child(2) div:nth-child(2) a strong').text().trim()\n    recommendation.mainRecommendation = $(this).find('tr td:nth-child(2) .detail-user-recs-text').text().trim()\n    recommendation.author = $(this).find('tr td:nth-child(2) > .borderClass .spaceit_pad:nth-child(2) > a').text().trim()\n    results.push(recommendation)\n  })\n\n  return results\n}\n\nconst searchPage = (url) => {\n  return new Promise((resolve, reject) => {\n    axios.get(url)\n      .then(({ data }) => {\n        const $ = cheerio.load(data)\n        const res = parsePage($)\n        resolve(res)\n      })\n      .catch(/* istanbul ignore next */(err) => reject(err))\n  })\n}\n\nconst getRecommendationsFromName = (name) => {\n  return new Promise((resolve, reject) => {\n    getResultsFromSearch(name)\n      .then((items) => {\n        const { url } = items[0]\n\n        searchPage(`${encodeURI(url)}/userrecs`)\n          .then((data) => resolve(data))\n          .catch(/* istanbul ignore next */(err) => reject(err))\n      })\n      .catch(/* istanbul ignore next */(err) => reject(err))\n  })\n}\n\nconst getRecommendationsFromNameAndId = (id, name = 'anything') => {\n  return new Promise((resolve, reject) => {\n    searchPage(`${BASE_URI}${id}/${encodeURI(name)}/userrecs`)\n      .then((data) => resolve(data))\n      .catch(/* istanbul ignore next */(err) => reject(err))\n  })\n}\n\nconst getRecommendationsList = (obj) => {\n  return new Promise((resolve, reject) => {\n    if (!obj) {\n      reject(new Error('[Mal-Scraper]: No id nor name received.'))\n      return\n    }\n\n    if (typeof obj === 'object' && !obj[0]) {\n      const { id, name } = obj\n\n      if (!id || isNaN(+id) || (name && typeof name !== 'string')) {\n        reject(new Error('[Mal-Scraper]: Malformed input. ID or name is malformed or missing.'))\n        return\n      }\n\n      getRecommendationsFromNameAndId(id, name)\n        .then((data) => resolve(data))\n        .catch(/* istanbul ignore next */(err) => reject(err))\n    } else {\n      getRecommendationsFromName(obj)\n        .then((data) => resolve(data))\n        .catch(/* istanbul ignore next */(err) => reject(err))\n    }\n  })\n}\n\nmodule.exports = {\n  getRecommendationsList\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}